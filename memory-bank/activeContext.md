# アクティブコンテキスト

## 現在の作業フォーカス

Discord Bot Control Centerのコマンド管理機能とAPI連携フローの改善に取り組んでいます。特に以下の点に焦点を当てています：

1. API連携フローの最適化とバグ修正
2. コマンド作成・編集フローの改善
3. ビジュアルコマンドビルダーの実装
4. インタラクティブプレビュー機能の追加
5. ボット選択UIの改善

## 最近の変更

### 2025/3/15 - API連携フローの最適化とバグ修正

1. **複数API連携フロー機能の無限ループバグを修正**
   - 状態更新ロジックを最適化し、無限ループを防止
   - コンポーネント間の依存関係を整理し、不要な再レンダリングを防止
   - 深い比較を実装し、実際に変更がある場合のみ状態を更新するように改善

2. **API連携フローのテンプレート機能を改善**
   - テンプレートからAPI連携フローを正しく反映するように修正
   - テンプレートの設定内容を初期値として使用するロジックを改善
   - 複数APIの連携フローをテンプレートから簡単に設定できるように改善

3. **設定内容の表示を最適化**
   - API設定内容を常に表示するように改善し、ユーザーが設定内容を確認しやすく
   - 設定内容のプレビュー表示を追加し、編集モードでなくても設定内容を確認可能に
   - 設定内容の表示方法を改善し、より見やすく整理

4. **コンポーネントの最適化**
   - `api-flow-builder.tsx`の設定内容表示部分を改善
   - `command-wizard.tsx`の状態更新ロジックを最適化
   - `api-flow-step.tsx`の依存関係を最適化
   - `api-integration-panel.tsx`の状態更新ロジックを改善

### 2025/3/14 - コマンド管理機能の大幅改善

1. **ステップバイステップのコマンドウィザード**
   - タブベースのインターフェースから、より直感的なステップバイステップのウィザード形式に変更
   - 進捗状況を視覚的に表示するプログレスインジケーター
   - 各ステップでの入力検証機能
   - API連携をオプション設定の前に配置するフロー変更（ユーザーフィードバックに基づく改善）

2. **ビジュアルコマンドビルダー**
   - コマンドオプションをドラッグ＆ドロップで並べ替え可能
   - オプションタイプごとのアイコン表示
   - リアルタイムのコマンド構文プレビュー
   - 選択したオプションの詳細編集パネル

3. **インタラクティブコマンドプレビュー**
   - Discord風のUIでコマンド実行をシミュレーション
   - コマンドオプションの入力フォーム
   - ボットの応答表示
   - 実際のDiscordでの表示に近い視覚的フィードバック

4. **ボット選択UIの改善**
   - ボットを先に選択してから、そのボット専用のコマンドを表示する方式に変更
   - ボットごとのコマンド数を表示
   - ボット選択画面のカード形式のUIで視認性向上
   - 選択したボットのコマンドのみを表示し、検索フィルターはそのボット内で適用

5. **API連携フローの改善**
   - 基本情報入力時にAPI連携を選択できるように変更
   - API連携に基づいたコマンドオプションの自動提案機能
   - API連携ごとの専用設定パネル
   - API連携の視覚的な選択インターフェース

## アクティブな決定と考慮事項

1. **コマンド作成フロー**
   - ウィザード形式のステップバイステップアプローチを採用
   - 各ステップで必要な情報を明確に示し、ユーザーの混乱を減らす
   - バリデーションを各ステップで行い、エラーをリアルタイムでフィードバック
   - API連携を先に選択することで、後続のステップでの選択肢を最適化

2. **ビジュアルビルダー**
   - 直感的なドラッグ＆ドロップインターフェースでオプションの管理を容易に
   - リアルタイムプレビューでコマンドの構造を視覚化
   - オプションタイプごとのアイコンで視認性を向上

3. **インタラクティブプレビュー**
   - 実際のDiscord環境に近い見た目と操作感
   - コマンド実行のシミュレーションで、ユーザーが最終結果を確認可能
   - オプション入力フォームで、各オプションタイプに適した入力方法を提供

4. **ボット選択UI**
   - ボットを先に選択する方式で、コマンド管理の文脈をより明確に
   - カード形式のUIで視認性と操作性を向上
   - ボットごとのコマンド数を表示して、管理状況を一目で把握可能

5. **API連携フロー**
   - 基本情報入力時にAPI連携を選択することで、ユーザーの意図を早期に把握
   - 選択したAPIに基づいて、適切なオプションやプロンプトを提案
   - API連携の詳細設定を専用ステップで行うことで、設定の複雑さを分離

## 次のステップ

1. **テンプレートベースのコマンド作成UI**
   - 目的別テンプレート選択画面の実装
   - ウィザード形式の設定フローの強化
   - ビジュアルカスタマイズ機能の追加
   - AIアシスタント機能のテンプレート提供

2. **AIアシスタント機能テンプレート**
   - 過去ログ分析アシスタント
   - AI対話アシスタント
   - リンク検索・要約アシスタント
   - 音声認識アシスタント

3. **コマンド実行ログの表示機能**
   - コマンドの実行履歴を表示する機能を追加
   - 成功・失敗のステータスや実行時間などの情報を含める

4. **コマンドのバージョン管理**
   - コマンドの変更履歴を記録・表示する機能
   - 以前のバージョンへのロールバック機能

5. **コマンドのテスト機能**
   - コマンドをDiscordに実際に登録せずにテストできる機能
   - テスト結果のレポート機能
